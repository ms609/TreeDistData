---
title: "Measuring tree distance"
author: "Martin R. Smith"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
bibliography: ../inst/REFERENCES.bib
csl: ../inst/apa-old-doi-prefix.csl
vignette: >
  %\VignetteIndexEntry{Measuring tree similarity}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


```{R Tree-distance-averages, echo=FALSE, message=FALSE, cache=TRUE, fig.asp=1, fig.width=6, out.width='90%', fig.align='center'}
cbPalette8 <- Ternary::cbPalette8
AddLine <- function (dat, col) {
  nLeaves <- colnames(dat)
  points(nLeaves, dat['mean', ], pch=3, col=col)
  lines(nLeaves, dat['mean', ] + dat['sd', ], lty=3, col=col)
  lines(nLeaves, dat['mean', ] - dat['sd', ], lty=3, col=col)
}

data('randomTreeDistances', package='TreeDist')
dists <- randomTreeDistances
hi2lo <- c('vai', 'vci', 'nts', 'qd', 'vpi', 'msd', 'path', 'spr', 'rf')

plot(as.integer(dimnames(dists)[[3]]), dists['vai', 'mean', ],
     pch='.', ylim=c(0.25, 1), col='white',
     xlab = "Number of tips", ylab = "Normalized tree distance")
for (i in 1:5) AddLine(dists[hi2lo[i], , ], col=cbPalette8[i])
# Crude normalization against diameter
AddLine(dists['msd', , ] / rep((nLeaves * nLeaves * 3 / 8), each=2), col=cbPalette8[6])
AddLine(dists['path', , ] / rep((nLeaves * 8), each=2), col=cbPalette8[7])
AddLine(dists['spr', , ], col=cbPalette8[8])
AddLine(dists['rf', , ], col=cbPalette8[8])


legend('bottomright', bty='n', pch=3, 
       legend=c('Var. Arb Info', 'Var. Clustering Info', 'Nye et al.',
                'Quartet dissimilarity', 'Var. Partition Info',
                'Matching Splits', 'Path', 'SPR',
                'Robinson-Foulds'), 
       col=cbPalette8[c(1:5, 6, 7, 8, 8)])
```

```{R Tree-distance-distributions, echo=FALSE, message=FALSE, cache=TRUE, fig.asp=1, fig.width=6, out.width='90%', fig.align='center'}
par(mfrow=c(3, 3), mar=rep(1.9, 4), cex=0.8, oma=c(0, 0, 2, 0))
manyBreaks <- seq(0, 1, length.out=40)

PlotHist <- function (distances, breaks, title, ...) {
  hist(distances, xlab=NULL, main=NULL, breaks=breaks, cex=0.8, ...)
  legend('topleft', bty='n', c('', '', title), cex=0.8)
}

data('distanceDistribution25', package='TreeDist')
dists <- distanceDistribution25

PlotHist(dists['vai', ], manyBreaks, 'Var. Arb Info', border=cbPalette8[1])
mtext('Distance between pectinate tree (above) and random bifurcating trees', outer=TRUE, cex=0.8)

PlotHist(dists['vci', ], manyBreaks, 'Var. Clustering Info', border=cbPalette8[2])
PlotHist(dists['nts', ], manyBreaks, 'Nye et al.', border=cbPalette8[3])
PlotHist(dists['qd', ],  manyBreaks,  'Quartet dissimilarity', border=cbPalette8[4])
PlotHist(dists['vpi', ], manyBreaks, 'Var. Partition Info', border=cbPalette8[5])
PlotHist(dists['msd', ],  manyBreaks * max(dists['msd', ]),  'Matching Splits', border=cbPalette8[6])
PlotHist(dists['path', ],  manyBreaks * max(dists['path', ]),  'Path', border=cbPalette8[7])
PlotHist(dists['spr', ], 0:max(dists['spr', ]),  'SPR', border=cbPalette8[8])
PlotHist(dists['rf', ],  manyBreaks * 44,  'Robinson-Foulds', border=cbPalette8[8])

```
